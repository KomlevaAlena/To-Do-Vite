import { todoModel } from './todo-model.js';
import { todoView } from './todo-view.js';
class TodoController {
    constructor() {
        console.log('‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–æ–∑–¥–∞–Ω');
        // –≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    // –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–ª–∞—Å—Å–∞

    this.todoForm = null;
    this.todoInput = null;
    this.addButton = null;
    console.log('üìä –ú–æ–¥–µ–ª—å –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã');
    }

    init() {
        // –ú–µ—Ç–æ–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–∑–∞–ø—É—Å–∫–∞) –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
        console.log('‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è');
        // –ó–¥–µ—Å—å –±—É–¥–µ–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ä–∞–∑—É
        this.findElements();
        // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ - –∂–¥—ë–º –∏ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ 100–º—Å
        if (!this.todoForm) {
            console.log('‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ, –∏—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã...');
            this.waitForComponents();
        } else {
            this.setupEventListeners();
        }
    }

    waitForComponents() {
        const checkInterval = setInterval(() => {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä—è—é –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤...');
            this.findElements();

            if (this.todoForm) {
                console.log('üéâ –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã!');
                clearInterval(checkInterval);// –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
                this.setupEventListeners();// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            }
        }, 100);
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    findElements() {
       console.log('üîç –ò—â—É —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ...');
       // –ù–∞—Ö–æ–¥–∏–º —Ñ–æ—Ä–º—É –ø–æ –∫–ª–∞—Å—Å—É
       this.todoForm = document.querySelector('.todo-input__form');
       // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ –∫–ª–∞—Å—Å—É
       this.todoInput = document.querySelector('.todo-input__field');
       // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É –ø–æ –∫–ª–∞—Å—Å—É
       this.addButton = document.querySelector('.todo-input__button');

       if (this.todoForm) {
        console.log('‚úÖ –§–æ—Ä–º–∞ –Ω–∞–π–¥–µ–Ω–∞:', this.todoForm);
       }
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    setupEventListeners() {
        console.log('üéß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π...');

        if (!this.todoForm || !this.todoInput || !this.addButton) {
            console.error('‚ùå –ù–µ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã!');
            return;
        }
        console.log('‚úÖ –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ');
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–ª–±—ç–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏
        todoView.setOnDeleteCallback(this.handleDeleteTodo.bind(this));// bind —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é, –≥–¥–µ this –≤—Å–µ–≥–¥–∞ = —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç
        // –®–ê–ì 1: –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è submit –Ω–∞ —Ñ–æ—Ä–º—É
        this.todoForm.addEventListener('submit', (event) => {
            // –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è
            console.log('üéØ –°–æ–±—ã—Ç–∏–µ submit —Å—Ä–∞–±–æ—Ç–∞–ª–æ!');
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
            // (–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
            event.preventDefault();
            // –®–ê–ì 2: –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞
            const todoText = this.todoInput.value;
            console.log('üìù –¢–µ–∫—Å—Ç –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞:', todoText);
            // –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—É—Å—Ç–æ–π –ª–∏ —Ç–µ–∫—Å—Ç
            // .trim() —É–¥–∞–ª—è–µ—Ç –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
            if (todoText.trim() === '') {
                console.log('‚ö†Ô∏è –ü—É—Å—Ç–∞—è –∑–∞–¥–∞—á–∞, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º');
                return; //–≤—ã—Ö–æ–¥–∏–º –∏–∑ –∑–∞–¥–∞—á–∏
            }
            // –®–ê–ì 4: –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
            console.log('üíæ –î–æ–±–∞–≤–ª—è—é –∑–∞–¥–∞—á—É –≤ –º–æ–¥–µ–ª—å...');
            const newTodo = todoModel.addTodo(todoText);

            if (newTodo) {
                console.log('‚úÖ –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –º–æ–¥–µ–ª—å:', newTodo);
                // –ü–û–õ–£–ß–ê–ï–ú –í–°–ï –ó–ê–î–ê–ß–ò –ò–ó –ú–û–î–ï–õ–ò
                const allTodos = todoModel.getAllTodos();
                console.log('üìã –í—Å–µ –∑–∞–¥–∞—á–∏ –≤ –º–æ–¥–µ–ª–∏:', allTodos);
                // –ü–ï–†–ï–î–ê–ï–ú –ó–ê–î–ê–ß–ò –í –ü–†–ï–î–°–¢–ê–í–õ–ï–ù–ò–ï –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø
                todoView.renderTodos(allTodos);
            } else {
                console.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ –º–æ–¥–µ–ª—å');
            }
            // –®–ê–ì 5: –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            this.todoInput.value = '';
            console.log('üßπ –ü–æ–ª–µ –≤–≤–æ–¥–∞ –æ—á–∏—â–µ–Ω–æ');
            // –®–ê–ì 6: –§–æ–∫—É—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ (—É–¥–æ–±–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
            this.todoInput.focus();
            // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å
            console.log('‚úÖ –ó–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞:', todoText);
        });
        console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è submit –¥–æ–±–∞–≤–ª–µ–Ω');
    }
    // –ú–µ—Ç–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
    handleDeleteTodo(todoId) {
        console.log('üéØ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å id:', todoId);
        // –£–¥–∞–ª—è–µ–º –∑–∞–¥–∞—á—É –∏–∑ –º–æ–¥–µ–ª–∏
        const isDeleted = todoModel.removeTodo(todoId);

        if (isDeleted) {
            console.log('‚úÖ –ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –º–æ–¥–µ–ª–∏');
            // –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
            const allTodos = todoModel.getAllTodos();
            console.log('üìã –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á:', allTodos);
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
            todoView.renderTodos(allTodos);
        } else {
            console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É –∏–∑ –º–æ–¥–µ–ª–∏');
        }
    }
}

const todoController = new TodoController(); // –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä (–æ–±—ä–µ–∫—Ç) –Ω–∞—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

export { todoController }; // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –µ–≥–æ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö
